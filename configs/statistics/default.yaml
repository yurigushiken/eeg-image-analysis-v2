# Statistical Analysis Configuration (Phase 2B)
#
# This configuration file controls which statistical tests are run
# and how results are saved. It works with subject_measurements.csv
# generated from Phase 2A.
#
# Usage:
#   python scripts/run_statistics.py --config configs/statistics/default.yaml

# ============================================================================
# Input Configuration
# ============================================================================

# Path to subject-level measurements CSV (from Phase 2A)
# Can be absolute or relative to project root
input_csv: "docs/assets/tables/landing_on_2/subject_measurements.csv"

# Output directory for statistical results
output_dir: "docs/assets/stats/landing_on_2"

# ============================================================================
# Data Filtering
# ============================================================================

# Quality control filters applied before analysis
filters:
  # Minimum signal-to-noise ratio threshold
  # Set to null to disable SNR filtering
  min_snr: null

  # Whether to drop rows with NaN values
  dropna: true

# ============================================================================
# Multiple Comparison Correction Strategy (Phase 2C - IA #2)
# ============================================================================

# How to apply multiple comparison corrections across tests
correction_family: "component"
# Options:
#   "component" - Correct within each component separately (recommended)
#                 e.g., 10 pairwise tests for N1, 10 for P3b = 2 families
#   "analysis"  - Correct across all tests in this analysis
#                 e.g., all N1 + P3b tests = 1 family (more conservative)
#   "global"    - Correct across all analyses (most conservative)
#   "none"      - No family-wise correction (not recommended)

# ============================================================================
# Components and Dependent Variables
# ============================================================================

# Which ERP components to analyze
components:
  - N1
  - P1
  - P3b

# Dependent variables to test (project-wide default: peak metrics)
# Options: 'latency_frac_area_ms', 'mean_amplitude_roi', 'peak_latency_ms', 'peak_amplitude_roi'
dependent_variables:
  # - peak_latency_ms
  # - peak_amplitude_roi
  - mean_amplitude_roi
  - latency_frac_area_ms

# ============================================================================
# Statistical Tests Configuration
# ============================================================================

tests:
  # ---------------------------------------------------------------------------
  # Repeated-Measures ANOVA
  # ---------------------------------------------------------------------------
  anova:
    enabled: true

    # Within-subjects factor (typically 'condition')
    within: condition

    # Subject identifier column
    subject: subject_id

    # Output file format: 'csv' or 'json'
    output_format: csv

    # Whether to save detailed results
    detailed: true

  # ---------------------------------------------------------------------------
  # Pairwise T-Tests
  # ---------------------------------------------------------------------------
  pairwise:
    enabled: true

    # Within-subjects factor
    within: condition

    # Subject identifier column
    subject: subject_id

    # Multiple comparison correction method
    # Options: 'fdr_bh' (Benjamini-Hochberg FDR), 'bonf' (Bonferroni),
    #          'holm' (Holm-Bonferroni), 'none' (no correction)
    correction: fdr_bh

    # Effect size measure
    # Options: 'cohen' (Cohen's d), 'hedges' (Hedges' g), 'eta-square'
    effsize: cohen

    # Output format
    output_format: csv

  # ---------------------------------------------------------------------------
  # Linear Mixed-Effects Models (LMM)
  # ---------------------------------------------------------------------------
  lmm:
    enabled: true

    # Fixed effects formula
    # Examples:
    #   'condition' - single factor
    #   'condition + snr' - condition with SNR covariate (RECOMMENDED)
    #   'condition * snr' - with interaction
    fixed: condition + snr

    # Random effects grouping variable (typically 'subject_id')
    random: subject_id

    # Fitting method: 'lbfgs', 'powell', 'cg', 'bfgs'
    method: lbfgs

    # Output format
    output_format: json

    # Whether to include model diagnostics
    include_diagnostics: true

  # ---------------------------------------------------------------------------
  # LMM Pairwise Comparisons (all condition pairs via MixedLM)
  # ---------------------------------------------------------------------------
  lmm_pairwise:
    enabled: true
    # Use the same fixed/random structure as LMM by default
    fixed: condition + snr
    random: subject_id
    # Multiple comparison correction for pairwise p-values
    # Options: 'hs' (Holm-Sidak), 'bonferroni', 'sidak', 'fdr_bh', 'none'
    correction: hs

# ============================================================================
# Descriptive Statistics
# ============================================================================

descriptives:
  enabled: true

  # Variable to group by (typically 'condition')
  groupby: condition

  # Output format
  output_format: csv

# ============================================================================
# Output Options
# ============================================================================

output:
  # Whether to print results to console
  print_to_console: true

  # Decimal precision for saved results
  decimal_precision: 4

  # Whether to create a summary report (combined results)
  create_summary: true

  # Summary report filename
  summary_filename: "statistical_summary.json"

# ============================================================================
# Plotting Configuration (Phase 2C)
# ============================================================================

plots:
  # Whether to generate plots
  enabled: true

  # Output subdirectory for plots (within output_dir)
  plots_subdir: "plots"

  # Boxplot settings
  boxplot:
    enabled: true
    show_points: true  # Show individual data points
    show_mean: true    # Show mean as red diamond
    include_window_context: true  # Add measurement window caption

  # Violin plot settings
  violin:
    enabled: true
    inner: "box"  # Options: "box", "quartile", "point", or null
    include_window_context: true

  # Effect size plot settings
  effect_size:
    enabled: true
    show_ci: true  # Show 95% confidence intervals
    threshold_lines: [0.2, 0.5, 0.8]  # Cohen's small, medium, large
    threshold_labels: ["Small", "Medium", "Large"]

  # Plot styling
  dpi: 300  # Publication quality
  figsize: [8, 6]  # Width, height in inches

# ============================================================================
# Enhanced Reporting (Phase 2C - Consultant Refinements)
# ============================================================================

reporting:
  # Include library versions in summary (IA #3)
  include_library_versions: true

  # Report Greenhouse-Geisser correction when sphericity violated (IA #1)
  include_gg_correction: true

  # Use generalized eta-squared (ng2) instead of partial (np2) (IA #4)
  use_generalized_eta_squared: true

  # Include 95% confidence intervals for effect sizes (IA #4)
  include_effect_size_ci: true

  # Explicitly document missing data handling (IA #6)
  document_missing_data: true

  # Include measurement window methodology in summary (IA #5)
  document_measurement_windows: true

# ============================================================================
# Advanced Options
# ============================================================================

advanced:
  # Random seed for reproducibility
  random_seed: 42

  # Significance threshold for highlighting in summary
  alpha: 0.05

  # Whether to save intermediate filtered data
  save_filtered_data: false

  # Verbosity level: 0 (quiet), 1 (normal), 2 (verbose)
  verbosity: 1
